// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
}

enum MessageRole {
  SYSTEM // System prompt (e.g. "You are a helpful assistant")
  USER // The user's input
  ASSISTANT // The AI's response
}

model User {
  id            String    @id @default(cuid())
  name          String?
  email         String?   @unique
  password      String?
  emailVerified DateTime?
  image         String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  roleId   Int?
  userRole UserRole? @relation(fields: [roleId], references: [id])

  // Relation: A user can have many AI chats
  chats Chat[]
}

model UserRole {
  id   Int    @id @default(autoincrement())
  name String @unique

  user User[]
}

model Chat {
  id        String   @id @default(cuid())
  title     String   @default("New Chat") // Title often generated by AI after first few messages
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  messages Message[]

  @@index([userId])
}

model Message {
  id        String      @id @default(cuid())
  content   String // The actual text content
  role      MessageRole // Enum: USER, ASSISTANT, SYSTEM
  createdAt DateTime    @default(now())

  // Optional: Track token usage for cost analysis
  promptTokens     Int?
  completionTokens Int?

  chatId String
  chat   Chat   @relation(fields: [chatId], references: [id], onDelete: Cascade)

  @@index([chatId])
}

model CareerOption {
  id          Int    @id @default(autoincrement())
  code        Int    @unique // N° from the document (1..22)
  career      String // Carrera
  shift       String // Turno
  level       String // Nivel
  area        String // Área
  description String // Descripción

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([career])
  @@index([shift])
  @@index([level])
  @@index([area])
}
